{% extends "base.html" %}

{% block title %}Recruitment Report{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/recruitment_report.css') }}">
{% endblock %}

{% block content %}
<div class="recruitment-container">
    <!-- Upcoming Events Column -->
    <div class="events-column">
        <h3>Upcoming Unfilled Events</h3>
        <div class="table-responsive">
            <table class="recruitment-table">
                <thead>
                    <tr>
                        <th class="sortable" data-sort="title">Event</th>
                        <th class="sortable" data-sort="date">Date</th>
                        <th class="sortable" data-sort="type">Type</th>
                        <th class="sortable" data-sort="slots">Slots</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event in events %}
                    {% if event.remaining_slots > 0 %}
                    <tr>
                        <td>
                            <strong>{{ event.title }}</strong>
                            <br>
                            <small>{{ event.description }}</small>
                        </td>
                        <td>{{ event.start_date.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>{{ event.type }}</td>
                        <td>
                            <div class="status-indicator status-needed"></div>
                            {{ event.filled_slots }}/{{ event.total_slots }}
                            <br>
                            <small class="text-danger">{{ event.remaining_slots }} needed</small>
                        </td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Volunteer Search Column -->
    <div class="volunteer-search-column">
        <h3>Volunteer Search</h3>
        <div class="search-container">
            <form method="get" action="{{ url_for('report.recruitment_report') }}">
                <input type="text" 
                       class="search-input" 
                       id="volunteerSearch" 
                       name="search" 
                       placeholder="Search volunteers by name, skills, or organization..."
                       value="{{ search_query }}">
                <button type="submit" class="btn btn-primary mt-2">Search</button>
            </form>
        </div>
        <div class="table-responsive">
            <table class="recruitment-table">
                <thead>
                    <tr>
                        <th class="sortable" data-sort="name">Volunteer</th>
                        <th class="sortable" data-sort="organization">Organization</th>
                        <th>Skills</th>
                        <th class="sortable" data-sort="last_activity">Last Activity</th>
                    </tr>
                </thead>
                <tbody id="volunteerTableBody">
                    {% for volunteer in volunteers %}
                    <tr>
                        <td>
                            <strong>{{ volunteer.name }}</strong>
                            <br>
                            <small>{{ volunteer.title }}</small>
                            <br>
                            <small>{{ volunteer.email }}</small>
                        </td>
                        <td>
                            {{ volunteer.organization }}
                            <br>
                            <small>{{ volunteer.industry }}</small>
                        </td>
                        <td>
                            {% for skill in volunteer.skills %}
                            <span class="skill-badge">{{ skill }}</span>
                            {% endfor %}
                        </td>
                        <td>
                            <small>
                                Last Volunteered: {{ volunteer.last_volunteer_date.strftime('%Y-%m-%d') if volunteer.last_volunteer_date else 'Never' }}
                                <br>
                                Last Email: {{ volunteer.last_email_date.strftime('%Y-%m-%d') if volunteer.last_email_date else 'Never' }}
                                <br>
                                Last Mailchimp: {{ volunteer.last_mailchimp_date.strftime('%Y-%m-%d') if volunteer.last_mailchimp_date else 'Never' }}
                            </small>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Add sorting functionality
document.querySelectorAll('th.sortable').forEach(th => {
    th.addEventListener('click', () => {
        const table = th.closest('table');
        const tbody = table.querySelector('tbody');
        const rows = Array.from(tbody.querySelectorAll('tr'));
        const column = th.dataset.sort;
        const isAsc = !th.classList.contains('asc');
        
        // Update sort indicators
        table.querySelectorAll('th').forEach(header => {
            header.classList.remove('asc', 'desc');
        });
        th.classList.add(isAsc ? 'asc' : 'desc');

        // Sort rows
        rows.sort((a, b) => {
            const aValue = a.querySelector(`td:nth-child(${Array.from(th.parentNode.children).indexOf(th) + 1})`).textContent;
            const bValue = b.querySelector(`td:nth-child(${Array.from(th.parentNode.children).indexOf(th) + 1})`).textContent;
            return isAsc ? aValue.localeCompare(bValue) : bValue.localeCompare(aValue);
        });

        // Reorder rows
        rows.forEach(row => tbody.appendChild(row));
    });
});
</script>
{% endblock %}